<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sri Hanumaan Trader's Lucky Draw</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0"></script>
    
    <style>
        body { background: #000; color: #fff; font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        h1 { color: #FFD700; margin-bottom: 20px; }
        .btn-custom { background: #FFD700; color: #000; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
        table { width: 100%; background: #fff; color: #000; margin-top: 20px; border-radius: 5px; }
        th, td { padding: 10px; border: 1px solid #ddd; }
        #winnerList { margin-top: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Sri Hanumaan Trader's Lucky Draw</h1>
    <button class="btn-custom" onclick="startLuckyDraw()">Start Lucky Draw</button>

    <div id="winnerList" class="hidden">
        <h2>Winners</h2>
        <table id="winnersTable" class="table table-bordered">
            <thead>
                <tr><th>Coupon No</th><th>Prize</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <audio id="winSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>

    <script>
        let participants = Array.from({ length: 100 }, (_, i) => i + 1); // 100 coupons
        let winners = [];
        const prizeStructure = [
            { prize: '6 grams Gold', count: 1 },
            { prize: '4 grams Gold', count: 2 },
            { prize: '3 grams Gold', count: 3 },
            { prize: '2 grams Gold', count: 4 },
            { prize: '1 gram Gold', count: 5 },
            { prize: '0.5 grams Silver', count: 6 }
        ];

        async function startLuckyDraw() {
            if (participants.length === 0) return alert("No participants left.");

            let shuffled = [...participants].sort(() => 0.5 - Math.random());
            winners = [];

            for (const prize of prizeStructure) {
                for (let i = 0; i < prize.count && shuffled.length > 0; i++) {
                    const winnerCoupon = shuffled.pop();
                    winners.push({ couponNumber: winnerCoupon, prize: prize.prize });

                    if (['6 grams Gold', '4 grams Gold', '3 grams Gold'].includes(prize.prize)) {
                        triggerConfetti();
                    }
                    playWinSound();
                    await sleep(1500);
                    renderWinners();
                }
            }

            shuffled.forEach(coupon => winners.push({ couponNumber: coupon, prize: 'Common Gift' }));
            renderWinners();
        }

        function triggerConfetti() {
            const colors = ['#ff0', '#f00', '#0f0', '#00f', '#ff4500', '#9400d3', '#00ffff', '#ff1493'];

            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: Array.from({ length: 5 }, () => colors[Math.floor(Math.random() * colors.length)])
            });
        }

        function playWinSound() {
            document.getElementById('winSound').play();
        }

        function renderWinners() {
            const winnerList = document.getElementById('winnerList');
            winnerList.classList.remove('hidden');
            const tbody = document.querySelector('#winnersTable tbody');
            tbody.innerHTML = '';
            winners.forEach(w => {
                tbody.innerHTML += `
                    <tr>
                        <td>${w.couponNumber}</td>
                        <td>${w.prize}</td>
                    </tr>`;
            });
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
