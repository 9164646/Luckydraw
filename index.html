<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Lucky Draw</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        body { background: #000; color: #fff; text-align: center; font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #FFD700; margin-bottom: 20px; }
        .btn-custom { background: #FFD700; color: #000; border: none; padding: 10px 10px; margin: 5px; border-radius: 5px; cursor: pointer; }
        #participants { width: 100%; margin: 20px 0; text-align: left; color: #000; }
        #countdown { font-size: 48px; color: #FFD700; margin: 20px 0; }
        #winnerList { margin-top: 20px; }
        #winnersTable { width: 100%; color: #000; background: #fff; margin-top: 20px; border: 1px solid #ddd; }
        th, td { padding: 10px; border: 1px solid #ddd; }
        .hidden { display: none; }
        .winner-announcement { animation: bounce 1s ease; color: #FFD700; font-size: 24px; margin-top: 10px; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-30px); } 60% { transform: translateY(-15px); } }
    </style>
</head>
<body>
    <h1>Lucky Draw</h1>

    <button class="btn-custom" onclick="addParticipant()">Add Participant</button>
    <button class="btn-custom" onclick="startLuckyDraw()">Start Draw</button>
    <button class="btn-custom" onclick="exportPDF()">Export PDF</button>
    <button class="btn-custom" onclick="exportCSV()">Export CSV</button>
    <button class="btn-custom" onclick="resetDraw()">Reset</button>

    <div>
        <h3>Total Participants: <span id="totalParticipants">0</span></h3>
        <textarea id="participants" rows="10" class="form-control"></textarea>
    </div>

    <h2 id="countdown" class="hidden"></h2>

    <div id="winnerList" class="hidden">
        <h2>Winners</h2>
        <table id="winnersTable" class="table table-bordered">
            <thead><tr><th>Coupon No</th><th>Prize</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let participants = [];
        let winners = [];
        const prizeStructure = [
            { prize: '6 grams Gold', count: 1 },
            { prize: '4 grams Gold', count: 2 },
            { prize: '3 grams Gold', count: 3 },
            { prize: '2 grams Gold', count: 4 },
            { prize: '1 gram Gold', count: 5 },
            { prize: '0.5 grams Silver', count: 6 },
            { prize: 'Consolation Prize', count: 10 }
        ];

        function addParticipant() {
            const input = prompt("Enter participant name:");
            if (input) {
                participants.push(input);
                updateParticipants();
            }
        }

        function updateParticipants() {
            document.getElementById('participants').value = participants.join('\n');
            document.getElementById('totalParticipants').textContent = participants.length;
        }

        function resetDraw() {
            participants = [];
            winners = [];
            document.getElementById('participants').value = '';
            document.getElementById('winnersTable').querySelector('tbody').innerHTML = '';
            updateParticipants();
            alert("Draw Reset!");
        }

        async function startLuckyDraw() {
            if (participants.length === 0) {
                alert("No participants available!");
                return;
            }

            let shuffled = [...participants].sort(() => 0.5 - Math.random());
            winners = [];

            for (const prize of prizeStructure) {
                for (let i = 0; i < prize.count && shuffled.length > 0; i++) {
                    await countdown(3);
                    const winner = shuffled.pop();
                    winners.push({ name: winner, prize: prize.prize });

                    // Announce the winner
                    announceWinner(winner, prize.prize);
                    triggerConfetti();
                    renderWinners();
                    await sleep(2000);
                }
            }

            renderWinners();
        }

        function announceWinner(name, prize) {
            const message = `${name} wins ${prize}`;
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.lang = 'en-US';
            speechSynthesis.speak(utterance);
        }

        function triggerConfetti() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }

        function renderWinners() {
            const winnerList = document.getElementById('winnerList');
            winnerList.classList.remove('hidden');
            const tbody = document.querySelector('#winnersTable tbody');
            tbody.innerHTML = '';
            winners.forEach(w => {
                tbody.innerHTML += `
                    <tr class="winner-announcement">
                        <td>${w.name}</td>
                        <td>${w.prize}</td>
                    </tr>`;
            });
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("Lucky Draw Winners", 20, 10);
            winners.forEach((w, i) => doc.text(`${i + 1}. ${w.name} - ${w.prize}`, 20, 20 + i * 10));
            doc.save('winners.pdf');
        }

        function exportCSV() {
            let csvContent = "data:text/csv;charset=utf-8,Coupon No,Prize\n";
            winners.forEach(w => {
                csvContent += `${w.name},${w.prize}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "winners.csv");
            document.body.appendChild(link);
            link.click();
        }

        async function countdown(seconds) {
            const countdownElement = document.getElementById('countdown');
            countdownElement.classList.remove('hidden');
            for (let i = seconds; i > 0; i--) {
                countdownElement.textContent = i;
                await sleep(1000);
            }
            countdownElement.classList.add('hidden');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        updateParticipants();
    </script>
</body>
</html>
