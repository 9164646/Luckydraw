<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sri Hanumaan Trader's Lucky Draw</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        h1 { color: #FFD700; margin-bottom: 20px; }
        .btn-custom { background: #FFD700; color: #000; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
        table { width: 100%; background: #fff; color: #000; margin-top: 20px; border-radius: 5px; }
        th, td { padding: 10px; border: 1px solid #ddd; }
        #winnerList { margin-top: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<h1>Sri Hanumaan Trader's Lucky Draw</h1>
<button class="btn-custom" onclick="toggleAdminPanel()">Admin Panel</button>
<button class="btn-custom" onclick="startDraw()">Start Lucky Draw</button>
<button class="btn-custom" onclick="exportWinnersPDF()">Download PDF</button>
<button class="btn-custom" onclick="exportWinnersExcel()">Download Excel</button>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden">
    <h2>Manage Participants</h2>
    <input type="text" id="participantName" placeholder="Enter Name" class="form-control mb-2">
    <input type="text" id="traderAddress" placeholder="Enter Trader Address" class="form-control mb-2">
    <button class="btn-custom" onclick="addParticipant()">Add/Update</button>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sri Hanumaan Trader's Lucky Draw</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        h1 { color: #FFD700; margin-bottom: 20px; }
        .btn-custom { background: #FFD700; color: #000; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
        table { width: 100%; background: #fff; color: #000; margin-top: 20px; border-radius: 5px; }
        th, td { padding: 10px; border: 1px solid #ddd; }
        #winnerList { margin-top: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<h1>Sri Hanumaan Trader's Lucky Draw</h1>
<button class="btn-custom" onclick="toggleAdminPanel()">Admin Panel</button>
<button id="startDrawBtn" class="btn-custom" onclick="startDraw()">Start Lucky Draw</button>
<button class="btn-custom" onclick="exportWinnersPDF()">Download PDF</button>
<button class="btn-custom" onclick="exportWinnersExcel()">Download Excel</button>
<button class="btn-custom" onclick="resetWinners()">Reset Winners</button>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden">
    <h2>Manage Participants</h2>
    <input type="text" id="participantName" placeholder="Enter Name" class="form-control mb-2">
    <input type="text" id="traderAddress" placeholder="Enter Trader Address" class="form-control mb-2">
    <button class="btn-custom" onclick="addParticipant()">Add/Update</button>

    <table id="participantTable" class="table table-bordered mt-3">
        <thead><tr><th>S. No</th><th>Name</th><th>Trader Address</th><th>Actions</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<!-- Winners Section -->
<div id="winnerList" class="hidden"></div>

<script>
    let participants = JSON.parse(localStorage.getItem('participants')) || [];
    let winners = JSON.parse(localStorage.getItem('winners')) || [];
    let editIndex = -1;

    // Prize structure
    const prizes = [
        { prize: '1st Prize - 6 Gram Gold', count: 1, gift: '6 Gram Gold' },
        { prize: '2nd Prize - 4 Gram Gold', count: 2, gift: '4 Gram Gold' },
        { prize: '3rd Prize - 3 Gram Gold', count: 3, gift: '3 Gram Gold' },
        { prize: '4th Prize - 2 Gram Gold', count: 4, gift: '2 Gram Gold' },
        { prize: '5th Prize - 1 Gram Gold', count: 5, gift: '1 Gram Gold' },
        { prize: '6th Prize - 0.5 Gram Silver', count: 6, gift: '0.5 Gram Silver' }
    ];

    // Toggle Admin Panel
    function toggleAdminPanel() {
        document.getElementById('adminPanel').classList.toggle('hidden');
        document.getElementById('winnerList').classList.add('hidden');
        renderTable();
    }

    // Add/Update Participant
    function addParticipant() {
        const name = document.getElementById('participantName').value.trim();
        const traderAddress = document.getElementById('traderAddress').value.trim();
        if (name && traderAddress) {
            if (editIndex === -1) {
                participants.push({ name, traderAddress });
            } else {
                participants[editIndex] = { name, traderAddress };
                editIndex = -1;
            }
            localStorage.setItem('participants', JSON.stringify(participants));
            renderTable();
        } else {
            alert("Please enter both Name and Trader Address.");
        }
    }

    // Render Participant Table
    function renderTable() {
        const tbody = document.querySelector('#participantTable tbody');
        tbody.innerHTML = '';
        participants.forEach((p, i) => {
            tbody.innerHTML += `<tr>
                <td>${i + 1}</td>
                <td>${p.name}</td>
                <td>${p.traderAddress}</td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editParticipant(${i})">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteParticipant(${i})">Delete</button>
                </td>
            </tr>`;
        });
    }

    // Start Draw with Validation
    function startDraw() {
        const totalWinnersNeeded = prizes.reduce((acc, prize) => acc + prize.count, 0);
        if (participants.length < totalWinnersNeeded) {
            alert("Not enough participants to conduct the draw!");
            return;
        }

        if (winners.length > 0) {
            alert("Lucky Draw already completed!");
            return;
        }

        prizes.forEach(prize => {
            const eligible = participants.filter(p => !winners.find(w => w.name === p.name));
            for (let i = 0; i < prize.count; i++) {
                const randomIndex = Math.floor(Math.random() * eligible.length);
                winners.push({ ...eligible.splice(randomIndex, 1)[0], prize: prize.prize, gift: prize.gift });
            }
        });

        localStorage.setItem('winners', JSON.stringify(winners));
        document.getElementById('startDrawBtn').disabled = true;
        showWinners();
    }

    // Show Winners
    function showWinners() {
        const winnerList = document.getElementById('winnerList');
        winnerList.classList.remove('hidden');
        let html = "<h2>Winners List</h2>";
        prizes.forEach(prize => {
            const prizeWinners = winners.filter(w => w.prize === prize.prize);
            html += `<h3>${prize.prize}</h3><table class="table"><tr><th>Name</th><th>Trader Address</th><th>Gift</th></tr>`;
            prizeWinners.forEach(w => html += `<tr><td>${w.name}</td><td>${w.traderAddress}</td><td>${w.gift}</td></tr>`);
            html += "</table>";
        });
        winnerList.innerHTML = html;
    }

    // Reset Winners
    function resetWinners() {
        winners = [];
        localStorage.removeItem('winners');
        document.getElementById('startDrawBtn').disabled = false;
        document.getElementById('winnerList').innerHTML = '';
        alert("Winners reset successfully!");
    }

    renderTable();
</script>

</body>
</html>
