<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Lucky Draw</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0"></script>

    <style>
        body { background: #000; color: #fff; font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        h1 { color: #FFD700; margin-bottom: 20px; }
        .btn-custom { background: #FFD700; color: #000; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; margin: 5px; }
        table { width: 100%; background: #fff; color: #000; margin-top: 20px; border-radius: 5px; }
        th, td { padding: 10px; border: 1px solid #ddd; }
        #winnerList { margin-top: 20px; }
        .hidden { display: none; }
        #countdown { font-size: 48px; color: #FFD700; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Lucky Draw</h1>
    <button class="btn-custom" onclick="startLuckyDraw()">Start Lucky Draw</button>
    <button class="btn-custom" onclick="resetWinners()">Reset Winners</button>

    <h2 id="countdown" class="hidden"></h2>

    <div>
        <label for="voiceSelect">Select Voice:</label>
        <select id="voiceSelect" class="form-control w-25 mx-auto my-3">
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select>
    </div>

    <div id="winnerList" class="hidden">
        <h2>Winners</h2>
        <table id="winnersTable" class="table table-bordered">
            <thead>
                <tr><th>Coupon No</th><th>Prize</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <audio id="bgMusic" loop>
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-01.mp3" type="audio/mpeg">
    </audio>

    <script>
        let participants = Array.from({ length: 100 }, (_, i) => i + 1); // 100 coupons
        let winners = [];
        const prizeStructure = [
            { prize: '6 grams Gold', count: 1 },
            { prize: '4 grams Gold', count: 2 },
            { prize: '3 grams Gold', count: 3 },
            { prize: '2 grams Gold', count: 4 },
            { prize: '1 gram Gold', count: 5 },
            { prize: '0.5 grams Silver', count: 6 }
        ];

        async function startLuckyDraw() {
            if (participants.length === 0) return alert("No participants left.");
            
            // Start background music
            document.getElementById('bgMusic').play();

            let shuffled = [...participants].sort(() => 0.5 - Math.random());
            winners = [];

            for (const prize of prizeStructure) {
                for (let i = 0; i < prize.count && shuffled.length > 0; i++) {
                    await countdown(3);  // 3-second countdown before announcement
                    const winnerCoupon = shuffled.pop();
                    winners.push({ couponNumber: winnerCoupon, prize: prize.prize });

                    // Voice announcement
                    announceWinner(winnerCoupon, prize.prize);

                    // Confetti for big prizes
                    if (['6 grams Gold', '4 grams Gold', '3 grams Gold'].includes(prize.prize)) {
                        triggerConfetti();
                    }

                    await sleep(2000);  // Delay for suspense
                    renderWinners();
                }
            }

            // Remaining participants get a common gift
            shuffled.forEach(coupon => winners.push({ couponNumber: coupon, prize: 'Common Gift' }));
            renderWinners();

            // Stop background music after the draw
            document.getElementById('bgMusic').pause();
        }

        function announceWinner(couponNumber, prize) {
            const voiceSelect = document.getElementById('voiceSelect').value;
            const message = `Coupon Number ${couponNumber} wins ${prize}`;
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            
            // Choose male or female voice
            const voices = speechSynthesis.getVoices();
            utterance.voice = voices.find(voice => 
                (voiceSelect === 'male' && voice.name.includes('Male')) || 
                (voiceSelect === 'female' && voice.name.includes('Female'))
            ) || voices[0];
            
            speechSynthesis.speak(utterance);
        }

        function triggerConfetti() {
            const colors = ['#ff0', '#f00', '#0f0', '#00f', '#ff4500', '#9400d3', '#00ffff', '#ff1493'];
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: Array.from({ length: 5 }, () => colors[Math.floor(Math.random() * colors.length)])
            });
        }

        function renderWinners() {
            const winnerList = document.getElementById('winnerList');
            winnerList.classList.remove('hidden');
            const tbody = document.querySelector('#winnersTable tbody');
            tbody.innerHTML = '';
            winners.forEach(w => {
                tbody.innerHTML += `
                    <tr>
                        <td>${w.couponNumber}</td>
                        <td>${w.prize}</td>
                    </tr>`;
            });
        }

        function resetWinners() {
            winners = [];
            alert("Winners have been reset.");
            renderWinners();
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function countdown(seconds) {
            const countdownElement = document.getElementById('countdown');
            countdownElement.classList.remove('hidden');
            for (let i = seconds; i > 0; i--) {
                countdownElement.textContent = i;
                await sleep(1000);
            }
            countdownElement.classList.add('hidden');
        }

        // Preload voices
        window.speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    </script>
</body>
</html>
